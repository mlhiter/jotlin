# 评论回复功能使用说明

## 功能概述

现在 Jotlin 支持评论回复功能，包括：

1. **嵌套回复**：用户可以回复其他用户的评论，支持多层嵌套
2. **AI 自动回复**：当在评论中 @AI 时，AI 不仅会执行相应的文档修改操作，还会自动在评论中回复执行结果

## 主要更新

### 1. 数据模型更新

在 `Comment` 模型中添加了：

- `parentId`: 支持评论嵌套
- `isAIReply`: 标识 AI 的回复
- `replies`: 子评论关系

### 2. UI 更新

- 评论支持多层嵌套显示，子评论会缩进显示
- 每条评论都有 "Reply" 按钮
- AI 的回复会有特殊标识（蓝色边框和 [AI] 标签）
- AI 回复会有淡蓝色背景以便区分

### 3. AI 回复功能

当用户在评论中 @AI 时：

1. AI 会解析指令并修改文档
2. AI 会自动创建一条回复评论，说明执行的操作
3. AI 用户使用特殊邮箱 `ai@jotlin.com`，头像使用项目 logo

## 使用示例

1. **普通回复**：
   - 点击评论下方的 "Reply" 按钮
   - 输入回复内容
   - 按 Enter 或点击 "Post Reply" 发送

2. **@AI 功能**：
   - 在评论中输入：`@AI 请帮我修改标题为"新标题"`
   - AI 会自动：
     - 修改文档标题
     - 在评论下方回复："已将标题修改为'新标题'"

## 技术实现细节

### API 端点更新

`POST /api/comments`:

- 新增 `parentId` 参数支持回复
- AI 处理后自动创建回复评论

`GET /api/comments`:

- 只返回顶级评论（parentId 为 null）
- 每个评论包含其所有回复（嵌套结构）

### 前端组件更新

`CommentList` 组件：

- 使用递归组件 `CommentItem` 渲染嵌套评论
- 支持回复输入框的显示/隐藏
- AI 回复的特殊样式处理

## 注意事项

1. AI 用户是系统自动创建的，不需要手动创建
2. AI 回复不支持编辑和删除
3. 用户不能回复 AI 的评论（避免无意义的对话）
4. 评论删除时会级联删除所有子回复
